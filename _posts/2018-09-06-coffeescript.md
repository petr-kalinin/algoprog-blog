---
layout: post
title: Coffeescript — мой любимый язык программирования (не совсем)
---

...Недавно меня спросили, какой мой любимый язык программирования.
Вообще, конечно, этот вопрос некорректный.
Языки отличаются по очень многим вещам, и нет какого-то одного идеального языка,
у каждого языка есть свои достинства и недостатки.

[Этот пост не совсем подходит к тематике этого блога,
потому что он не совсем про обучение программированию
и не про аккуратное программирование. Но тем не менее
я про Coffeescript давно хотел написать, и кажется,
лучше всего это написать сюда.]

Можно обсуждать отдельные аспекты языков. 
Например, стандартную бибилиотеку — в одних языках стандартная бибилиотека
очень богатая и позволяет делать много чего (привет питону с его `import antigravity`),
в других на многие вещи приходится искать внешние библиотеки (привет c++ с его boost'ом).
Можно обсуждать базовые конвенции языка — типизированный он или нет,
как работают неявные приведения типов (можно ли складывать число со строкой,
что кроме bool'ов можно засунуть в `if` и т.п.), как пишется основной код программы
(на самом верхнем уровне, как в паскале и питоне, или в специальной функции `main`
как в c++, или вообще надо создавать целый класс, как в java), и т.д. 
Можно обсуждать модель памяти, работу с указателями и ссылками, сборку мусора,
обработку ошибок, корутины и т.д. 

Но пожалуй лицо языка, то, что может именно *нравиться* (а не просто быть удобным
или подходящим к конкретной задаче) — кажется, это в первую очередь синтаксис языка.
(Да, я понимаю, что это спорное утверждение.)
Так вот, именно в плане синтаксиса мне очень нравится Coffeescript,
заметно больше, чем любой другой язык, на котором я хоть сколько-то много писал.

[Coffeescript](https://coffeescript.org/v2/) — это довольно небольшой язык программирования, 
компилирующийся в Javascript.
То есть вы пишете программу на Coffeescript, потом компилятором Coffeescript'а переводите
ее в эквивалентную программу на Javascript, и дальше уже интерпретатор Javascript ее выполняет.
По сути, Coffeescript отличается от Javascript'а только синтаксисом, это такой
синтаксический сахар над Javascript'ом, все остальное у обоих языков общее.

Последние несколько лет я относительно много пишу на Coffeescript — почти весь алгопрог, равно как и 
его предшественники — сводные таблицы для моего курса — написаны на Coffeescript
(вот [исходники алгопрога](https://github.com/petr-kalinin/algoprog)).

Создатели Coffeescript'а представляют его как «Javascript без скобочек», потому что
язык Javascript печально известен тем, что программы на нем содержат какое-то огромное количество скобок.
И Coffeescript показывает, что на самом деле бОльшую часть этих скобочек можно не писать,
лишь слегка изменив синтаксис языка.
Но я бы характеризовал Coffeescript еще и как «питон без двоеточий» (в плане синтаксиса, конечно).
Пописав на Coffeescript, понимаешь, что двоеточия в питоне не нужны, и вообще,
если смотреть поверхностно, то небольшие программы на Coffeescript намного больше похожи на питон,
чем на Javascript.

Так вот, что мне нравится в Coffeescript'е. 
Многое из того, что я пишу ниже, на самом деле
присутствует и в других языках, а зачастую и в современном Javascript (вообще, как я понимаю, 
современный Javascript взял некоторые фичи из первой версии Coffeescript'а),
но я не знаю другого языка, который бы включал все это вместе. (Ну разве что Kotlin,
про который я только читал пару популярных статей.)

Ну, во-первых, сразу скажу пару вещей, которые не то чтобы меня очень сильно впечатляют, 
но кажутся довольно приятными и нужны для понимания текста дальше.

Во-первых, вложенность конструкций в Coffeescript задается отступами, так же, как и в питоне:

    if a > b
        m = a
    else
        m = b

Во-вторых, любая функция в Coffeescript'е является лямбда-функцией,
т.е. безымянной функцией, просто при необходимости сохраненной в какую-нибудь переменную:

    f = (x) ->
        a = x * 2
        return a + 2
        
Это функция `f`, которая принимает один параметр `x` и возвращает `2*x+2`.

Теперь собственно к фичам — в некотором несколько случайном порядке. Я буду регулярно 
сравнивать с питоном (и иногда с c++), потому что это те языки, на которых я пишу больше всего,
и поэтому именно на них я зачастую страдаю от отсутствия Coffeescript'овских вещей.
    
В Javascript, и как следствие в Coffeescript, словари и объекты — это одно и то же.
На самом деле это то, чего мне очень часто не хватает в питоне. Часто хочется сделать 
по месту какую-нибудь простую структурку, которая хранила бы несколько именованных полей.
В питоне можно написать так:

    user = {"name": "John", "surname": "Doe"}
    
но тогда обращаться к полям нужно будет через квадратные скобки и кавычки: `user["name"]`.
А если хочется обращаться как `user.name`, то надо отдельно создавать объект,
скорее всего еще и класс сначала, и получается куча лишнего кода. Хотя если подумать,
то в нетипизированных языках объекты и словари очень похожи друг на друга,
и потому не очень понятно, зачем вводить два разных понятния.

Вот в Javascript и, соответственно, в Coffeescript не стали различать эти вещи.
Объект и словарь — это одно и то же. Можно писать

    # еще обратите внимание на отсутствие кавычек у ключей!
    user = {name: "John", surname: "Doe"}  
    user.admin = true  # создаем новый ключ
    fullname = user.name + " " + user.surname
    
Равным образом можно создать объект какого-нибудь класса и работать с ним как со словарем:

    foo = new Foo()
    foo["bar"] = "value"
    
На мой взгляд, это просто прекрасно. Зачем в питоне придумали две разных сущности, я не понимаю.

В Coffeescript еще, в отличие от Javascript, разрешили избавляться от скобочек следующей записью:

    user =
        name: "Василий"
        surname: "Пупкин"
        address:
           country: "Россия"
           city: "Тмутаракань"
           


           
----------           
           
Ну, во-первых, string interpolation. Внутри строковых констант можно включить
любое выражение в конструкции `#{...}` — выражение будет вычислено и вставлено в строку:

    w = "world"
    result = "Hello, #{w}!"  # дает "Hello world!"
    phrase = "В сутках #{60 * 60 * 24} секунд"
